import json
import time

# Define job name
job_name = "UKS_SIT_DW_E2E_Deployment"

# Define tasks list (Validation Task and DLT Pipeline Task)
tasks = [
    {
        "task_key": "ValidationTask",
        "notebook_path": "/Workspace/Repos/ODS_SIT_AUTOMATION_POC/notebooks/UKS_SIT_DW_E2E/ODS_BRONZE_VALIDATION_ESSENTIAL"
    },
    {
        "task_key": "DLT_PIPELINE",
        "notebook_path": "/Workspace/Repos/ODS_SIT_AUTOMATION_POC/notebooks/UKS_SIT_DW_E2E/DLT_REFRESH_PIPELINE",
        "depends_on": ["ValidationTask"]
    }
]

# Function to run a notebook
def run_notebook(notebook_path):
    try:
        print(f"Starting notebook: {notebook_path}")
        result = dbutils.notebook.run(notebook_path, timeout_seconds=0)
        print(f"Completed notebook: {notebook_path} - Result: {result}")
    except Exception as e:
        print(f"Error running {notebook_path}: {str(e)}")

# Run validation task
run_notebook(tasks[0]["notebook_path"])

# Run DLT task after validation
if "depends_on" in tasks[1] and tasks[1]["depends_on"][0] == "ValidationTask":
    time.sleep(5)  # Small delay to ensure previous task finishes
    run_notebook(tasks[1]["notebook_path"])
