import requests
import json

# Databricks configuration
api_token = "<your_databricks_api_token>"
api_url = "https://<databricks_instance>/api/2.0"

# Set up the HTTP request headers
headers = {
    "Authorization": f"Bearer {api_token}",
    "Content-Type": "application/json"
}

# Create a new job run
job_payload = {
    "run_name": "My Job Run",
    "existing_cluster_id": "<cluster_id>",
    "notebook_task": {
        "notebook_path": "/path/to/notebook"
    }
}

response = requests.post(f"{api_url}/jobs/runs/create", headers=headers, json=job_payload)
response.raise_for_status()

# Get the run ID from the response
run_id = response.json()["run_id"]

# Wait for the job run to complete
status = "RUNNING"

while status == "RUNNING":
    response = requests.get(f"{api_url}/jobs/runs/get?run_id={run_id}", headers=headers)
    response.raise_for_status()
    run_status = response.json()["state"]["life_cycle_state"]
    status = run_status["state"]

# Get the output of the job run
response = requests.get(f"{api_url}/jobs/runs/get-output?run_id={run_id}", headers=headers)
response.raise_for_status()

output = response.json()["notebook_output"]["result"]

# Print the output
print(output)
