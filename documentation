import requests
import json

# Azure Databricks cluster configuration
cluster_url = "https://<databricks-instance>.azuredatabricks.net"
token = "<databricks-access-token>"
repo_path = "your-repo-path/sample_file.py"

# API endpoint for Databricks jobs/runs
api_endpoint = f"{cluster_url}/api/2.0/jobs/runs/submit"

# Prepare the request headers with the authentication token
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json"
}

# Prepare the request body with the file to execute
data = {
    "run_name": "Databricks Run",
    "existing_cluster_id": "<cluster-id>",  # Enter your cluster ID here
    "notebook_task": {
        "notebook_path": repo_path
    }
}

# Send the request to Databricks to execute the file
response = requests.post(api_endpoint, headers=headers, data=json.dumps(data))

# Check if the request was successful
if response.status_code == 200:
    run_id = response.json()["run_id"]
    print(f"Run submitted successfully. Run ID: {run_id}")
else:
    print("Error submitting run:", response.text)
    exit()

# Get the output of the run
run_status_endpoint = f"{cluster_url}/api/2.0/jobs/runs/get-output?run_id={run_id}"

# Send a GET request to retrieve the output
response = requests.get(run_status_endpoint, headers=headers)

# Check if the request was successful
if response.status_code == 200:
    output = response.json()["notebook_output"]["result"]
    print("Output:")
    print(output)
else:
    print("Error retrieving output:", response.text)
