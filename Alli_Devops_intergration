import requests
from requests.auth import HTTPBasicAuth

# Configurable inputs
organization = "your-org"
project = "your-project"
pat = "your-personal-access-token"
excluded_ids = [12330, 11]

# Headers and auth
headers = {
    "Content-Type": "application/json"
}
auth = HTTPBasicAuth("", pat)

# Step 1: Get all test cases
url = f"https://dev.azure.com/{organization}/{project}/_apis/test/testcases?api-version=7.1-preview.1"
response = requests.get(url, headers=headers, auth=auth)

if response.status_code == 200:
    test_cases = response.json().get("value", [])
    for case in test_cases:
        case_id = case['id']
        if case_id not in excluded_ids:
            # Step 2: Delete test case
            del_url = f"https://dev.azure.com/{organization}/{project}/_apis/test/testcases/{case_id}?api-version=7.1-preview.1"
            del_response = requests.delete(del_url, headers=headers, auth=auth)
            if del_response.status_code in [200, 204]:
                print(f"Deleted Test Case ID: {case_id}")
            else:
                print(f"Failed to delete Test Case ID: {case_id} - {del_response.status_code}")
else:
    print(f"Failed to retrieve test cases: {response.status_code}")
    print(response.text)
