import requests
from requests.auth import HTTPBasicAuth

# Configuration
organization = "your-org"
project = "your-project"
pat = "your-pat"
assigned_to = "adm.sug.na"

# Auth setup
auth = HTTPBasicAuth("", pat)
headers = {
    "Content-Type": "application/json"
}

# Step 1: Get work items assigned to adm.sug.na
wiql_query = {
    "query": f"SELECT [System.Id] FROM WorkItems WHERE [System.AssignedTo] CONTAINS '{assigned_to}' AND [System.TeamProject] = '{project}'"
}

query_url = f"https://dev.azure.com/{organization}/{project}/_apis/wit/wiql?api-version=7.1-preview.2"
response = requests.post(query_url, headers=headers, auth=auth, json=wiql_query)

deleted_items = []

if response.status_code == 200:
    work_items = response.json().get("workItems", [])
    for item in work_items:
        wid = item["id"]
        delete_url = f"https://dev.azure.com/{organization}/_apis/wit/workitems/{wid}?api-version=7.1-preview.2"
        del_response = requests.delete(delete_url, headers=headers, auth=auth)

        if del_response.status_code in [200, 204]:
            deleted_items.append(wid)
            print(f"Deleted (soft) Work Item ID: {wid}")
        else:
            print(f"Failed to delete Work Item ID: {wid} - {del_response.status_code}")
else:
    print("Failed to query work items.")
    print(response.status_code, response.text)

# Final list of deleted items
print("\nâœ… Deleted Work Items:", deleted_items)
