import requests
from requests.auth import HTTPBasicAuth
import json

# Replace with your values
organization = "your-org"
project = "your-project"
run_id = "12345"  # ID of the test run to stop
pat = "your_personal_access_token"

# Azure DevOps API URL
url = f"https://dev.azure.com/{organization}/{project}/_apis/test/runs/{run_id}?api-version=7.1-preview.3"

# Headers and auth
headers = {
    "Content-Type": "application/json"
}
auth = HTTPBasicAuth("", pat)  # Username can be blank, PAT as password

# Body to abort the run
data = {
    "state": "Aborted"
}

# API call
response = requests.patch(url, headers=headers, auth=auth, data=json.dumps(data))

# Output result
if response.status_code == 200:
    print(f"Test run {run_id} aborted successfully.")
else:
    print(f"Failed to abort test run {run_id}.")
    print(f"Status Code: {response.status_code}")
    print(response.text)
