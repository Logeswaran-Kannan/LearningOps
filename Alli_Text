# =========================
# REFRESH TARGET DATA
# =========================
if table_exists:
    # Incremental run → refresh today only
    spark.sql(
        f"""
        DELETE FROM {TARGET_TABLE}
        WHERE EHUBQUEUEDDATESTAMP = current_date()
        """
    )
else:
    # First run → clean slate
    spark.sql(f"DELETE FROM {TARGET_TABLE}")

spark.sql(
    f"""
    DELETE FROM {TARGET_TABLE}
    WHERE EHUBQUEUEDDATESTAMP < date_sub(current_date(), 2)
    """
)
