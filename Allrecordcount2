SELECT
    CURRENT_DATE AS LOAD_DATE,
    TABLE_NAME_RESOLVED,
    
    -- Presence flags
    CASE WHEN MAX(CASE WHEN ORACLE_TABLE_NAME IS NOT NULL THEN 1 ELSE 0 END) = 1 THEN 1 ELSE 0 END AS PRESENT_IN_ORACLE,
    CASE WHEN MAX(CASE WHEN REPLICA_TABLE_NAME IS NOT NULL THEN 1 ELSE 0 END) = 1 THEN 1 ELSE 0 END AS PRESENT_IN_REPLICA,

    -- Metric counts
    COUNT(CASE WHEN COMPARISON_RESULT = 'MATCH' THEN 1 END) AS MATCH_COUNT,
    COUNT(CASE WHEN COMPARISON_RESULT = 'COLUMN MISSING IN ORACLE' THEN 1 END) AS COLUMN_MISSING_IN_ORACLE_COUNT,
    COUNT(CASE WHEN COMPARISON_RESULT = 'COLUMN MISSING IN REPLICA' THEN 1 END) AS COLUMN_MISSING_IN_REPLICA_COUNT,
    COUNT(CASE WHEN COMPARISON_RESULT = 'PRECISION OR SCALE MISMATCH' THEN 1 END) AS PRECISION_SCALE_MISMATCH_COUNT

FROM ddl_comparison_table  -- Replace with your actual base comparison table
GROUP BY TABLE_NAME_RESOLVED;
