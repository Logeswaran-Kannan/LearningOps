DO
$$
DECLARE
    tbl RECORD;
    row_count BIGINT;
    has_column BOOLEAN;
BEGIN
    FOR tbl IN
        SELECT tablename
        FROM pg_tables
        WHERE schemaname = 'public'
    LOOP
        -- Check if 'createtime' column exists
        SELECT EXISTS (
            SELECT 1
            FROM information_schema.columns
            WHERE table_schema = 'public'
              AND table_name = tbl.tablename
              AND column_name = 'createtime'
        ) INTO has_column;

        -- Get table row count
        EXECUTE format('SELECT count(*) FROM public.%I', tbl.tablename) INTO row_count;

        -- Log both count and column check
        RAISE NOTICE 'Table: %, Row Count: %, Has createtime: %',
            tbl.tablename, row_count, has_column;
    END LOOP;
END;
$$;
