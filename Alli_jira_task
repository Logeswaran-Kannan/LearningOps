import requests
import pandas as pd

# --- Configuration ---
token = "<your_personal_access_token>"
workspace_url = "https://adb-67779643136828772.12.azuredatabricks.net"
url = f"{workspace_url}/api/2.0/lineage-tracking/column-lineage"

headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json"
}

# --- Inputs ---
params = {
    "table_name": "core_tst_std001.ods_views.vw_policycenter_std001_current_pc_policy",
    "column_name": "productcode",  # You can loop over multiple columns if needed
    "include_entity_lineage": True
}

# --- Send Request ---
response = requests.get(url, headers=headers, params=params)

# --- Handle Response ---
if response.status_code == 200:
    data = response.json()
    downstream = data.get("downstream_columns", [])
    df = pd.json_normalize(downstream)
    print("✅ Downstream lineage retrieved.")
    display(df)
else:
    print(f"❌ API Error {response.status_code}: {response.text}")
