import pandas as pd
import requests

def link_defect_with_testcase(jira_url, jira_token, project_key, defect_id, testcase_id):
    headers = {
        "Authorization": f"Basic {jira_token}",
        "Content-Type": "application/json"
    }

    issue_key = f"{project_key}-{defect_id}"
    testcase_issue_key = f"{project_key}-{testcase_id}"

    data = {
        "type": {
            "name": "Relates"
        },
        "outwardIssue": {
            "key": issue_key
        },
        "inwardIssue": {
            "key": testcase_issue_key
        }
    }

    api_url = f"{jira_url}/rest/api/2/issueLink"
    response = requests.post(api_url, json=data, headers=headers)

    if response.status_code == 201:
        print(f"Successfully linked Defect {defect_id} with Testcase {testcase_id}")
    else:
        print(f"Failed to link Defect {defect_id} with Testcase {testcase_id}. Status code: {response.status_code}")

def main():
    # Replace with your Jira settings
    jira_url = "https://your-jira-instance.com"
    jira_token = "your-jira-token"
    project_key = "YOUR_PROJECT_KEY"

    # Read data from Excel file
    excel_file = "path/to/your/excel_file.xlsx"
    data = pd.read_excel(excel_file)

    for index, row in data.iterrows():
        defect_id = row['Defect ID']
        testcase_id = row['Testcase ID']
        link_defect_with_testcase(jira_url, jira_token, project_key, defect_id, testcase_id)

if __name__ == "__main__":
    main()
