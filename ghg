from pyspark.sql import SparkSession
from pyspark.sql.functions import col, when

def update_avro_file_with_condition(spark, avro_file_path):
    # Read the Avro file into a DataFrame
    df = spark.read.format("avro").load(avro_file_path)

    # Check the condition and update the "renewal" column accordingly
    updated_df = df.withColumn("renewal", when(col("polivyrefer") == 5678, "updated_value").otherwise(col("renewal")))

    # Write the updated DataFrame back to the Avro file
    updated_df.write.format("avro").mode("overwrite").save(avro_file_path)

if __name__ == "__main__":
    # Initialize SparkSession
    spark = SparkSession.builder \
        .appName("Update Avro File") \
        .getOrCreate()

    # Replace 'your_avro_file_path' with the actual DBFS path of the Avro file
    avro_file_path = "dbfs:/path/to/your_avro_file.avro"

    # Call the function to update the Avro file with the specified condition
    update_avro_file_with_condition(spark, avro_file_path)

    # Stop the SparkSession
    spark.stop()
